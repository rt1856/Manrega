<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>District Comparison - MGNREGA Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .analytics-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            border: none;
        }
        .comparison-card {
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .rank-badge {
            background: #ffc107;
            color: #000;
            font-size: 1.1rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }
        /* Language Selector Styles - Same as Dashboard */
        .language-selector-container {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 0.3rem 1rem;
            backdrop-filter: blur(10px);
        }
        .language-selector {
            background: transparent;
            border: none;
            color: white;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
            width: 120px;
        }
        .language-selector option {
            background: #2c3e50;
            color: white;
            padding: 10px;
        }
        .language-selector:focus {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 5px;
        }
        /* Language text styling */
        .lang-en { display: inline; }
        .lang-hi { display: none; }
        .lang-gu { display: none; }
        
        body[data-lang="hi"] .lang-en { display: none; }
        body[data-lang="hi"] .lang-hi { display: inline; }
        body[data-lang="hi"] .lang-gu { display: none; }
        
        body[data-lang="gu"] .lang-en { display: none; }
        body[data-lang="gu"] .lang-hi { display: none; }
        body[data-lang="gu"] .lang-gu { display: inline; }
    </style>
</head>
<body data-lang="gu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line"></i> MGNREGA Analytics
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item">
                    <div class="language-selector-container">
                        <select id="languageSelector" class="form-select language-selector">
                            <option value="en">English</option>
                            <option value="hi">हिन्दी</option>
                            <option value="gu" selected>ગુજરાતી</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="analytics-card p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="mb-1">
                                <span class="lang-en">{{ district_info.district_name }}</span>
                                <span class="lang-hi">{{ district_info.district_name_hindi }}</span>
                                <span class="lang-gu">{{ district_info.district_name_gujarati }}</span>
                            </h2>
                            <p class="mb-0">
                                <span class="lang-en">District Performance Comparison</span>
                                <span class="lang-hi">जिला प्रदर्शन तुलना</span>
                                <span class="lang-gu">જિલ્લા પ્રદર્શન તુલના</span>
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="rank-badge d-inline-block">
                                <i class="fas fa-trophy"></i> 
                                <span class="lang-en">Rank: {{ comparison_data.district_rank }}/{{ comparison_data.total_districts }}</span>
                                <span class="lang-hi">रैंक: {{ comparison_data.district_rank }}/{{ comparison_data.total_districts }}</span>
                                <span class="lang-gu">રેન્ક: {{ comparison_data.district_rank }}/{{ comparison_data.total_districts }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comparison Metrics -->
        <div class="row">
            <!-- Households Provided Employment -->
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="comparison-card p-3 h-100">
                    <h6 class="text-muted">
                        <span class="lang-en">Households Provided Employment</span>
                        <span class="lang-hi">रोजगार प्राप्त परिवार</span>
                        <span class="lang-gu">રોજગાર મળેલ ઘરો</span>
                    </h6>
                    <div class="metric-value text-primary">
                        {{ comparison_data.district.households_provided_employment|format_number }}
                    </div>
                    <div class="text-muted small">
                        <span class="lang-en">State Avg: {{ comparison_data.state_avg.households_provided_employment|format_number }}</span>
                        <span class="lang-hi">राज्य औसत: {{ comparison_data.state_avg.households_provided_employment|format_number }}</span>
                        <span class="lang-gu">સ્ટેટ એવરેજ: {{ comparison_data.state_avg.households_provided_employment|format_number }}</span>
                    </div>
                    {% set hh_percentage = comparison_data.comparison_percentages.households_provided_employment %}
                    <div class="mt-2">
                        {% if hh_percentage > 0 %}
                            <span class="positive"><i class="fas fa-arrow-up"></i> 
                                <span class="lang-en">{{ hh_percentage }}% above average</span>
                                <span class="lang-hi">{{ hh_percentage }}% औसत से ऊपर</span>
                                <span class="lang-gu">{{ hh_percentage }}% સરેરાશથી ઉપર</span>
                            </span>
                        {% elif hh_percentage < 0 %}
                            <span class="negative"><i class="fas fa-arrow-down"></i> 
                                <span class="lang-en">{{ hh_percentage|abs }}% below average</span>
                                <span class="lang-hi">{{ hh_percentage|abs }}% औसत से नीचे</span>
                                <span class="lang-gu">{{ hh_percentage|abs }}% સરેરાશથી નીચે</span>
                            </span>
                        {% else %}
                            <span class="text-muted">
                                <span class="lang-en">At state average</span>
                                <span class="lang-hi">राज्य औसत पर</span>
                                <span class="lang-gu">સ્ટેટ એવરેજ પર</span>
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Persons Worked -->
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="comparison-card p-3 h-100">
                    <h6 class="text-muted">
                        <span class="lang-en">Persons Worked</span>
                        <span class="lang-hi">कार्य किए गए व्यक्ति</span>
                        <span class="lang-gu">કામ કરનારા લોકો</span>
                    </h6>
                    <div class="metric-value text-primary">
                        {{ comparison_data.district.persons_worked|format_number }}
                    </div>
                    <div class="text-muted small">
                        <span class="lang-en">State Avg: {{ comparison_data.state_avg.persons_worked|format_number }}</span>
                        <span class="lang-hi">राज्य औसत: {{ comparison_data.state_avg.persons_worked|format_number }}</span>
                        <span class="lang-gu">સ્ટેટ એવરેજ: {{ comparison_data.state_avg.persons_worked|format_number }}</span>
                    </div>
                    {% set persons_percentage = comparison_data.comparison_percentages.persons_worked %}
                    <div class="mt-2">
                        {% if persons_percentage > 0 %}
                            <span class="positive"><i class="fas fa-arrow-up"></i> 
                                <span class="lang-en">{{ persons_percentage }}% above average</span>
                                <span class="lang-hi">{{ persons_percentage }}% औसत से ऊपर</span>
                                <span class="lang-gu">{{ persons_percentage }}% સરેરાશથી ઉપર</span>
                            </span>
                        {% elif persons_percentage < 0 %}
                            <span class="negative"><i class="fas fa-arrow-down"></i> 
                                <span class="lang-en">{{ persons_percentage|abs }}% below average</span>
                                <span class="lang-hi">{{ persons_percentage|abs }}% औसत से नीचे</span>
                                <span class="lang-gu">{{ persons_percentage|abs }}% સરેરાશથી નીચે</span>
                            </span>
                        {% else %}
                            <span class="text-muted">
                                <span class="lang-en">At state average</span>
                                <span class="lang-hi">राज्य औसत पर</span>
                                <span class="lang-gu">સ્ટેટ એવરેજ પર</span>
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Total Person Days -->
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="comparison-card p-3 h-100">
                    <h6 class="text-muted">
                        <span class="lang-en">Total Person Days</span>
                        <span class="lang-hi">कुल व्यक्ति दिवस</span>
                        <span class="lang-gu">કુલ વ્યક્તિ દિવસો</span>
                    </h6>
                    <div class="metric-value text-primary">
                        {{ comparison_data.district.total_person_days|format_number }}
                    </div>
                    <div class="text-muted small">
                        <span class="lang-en">State Avg: {{ comparison_data.state_avg.total_person_days|format_number }}</span>
                        <span class="lang-hi">राज्य औसत: {{ comparison_data.state_avg.total_person_days|format_number }}</span>
                        <span class="lang-gu">સ્ટેટ એવરેજ: {{ comparison_data.state_avg.total_person_days|format_number }}</span>
                    </div>
                    {% set days_percentage = comparison_data.comparison_percentages.total_person_days %}
                    <div class="mt-2">
                        {% if days_percentage > 0 %}
                            <span class="positive"><i class="fas fa-arrow-up"></i> 
                                <span class="lang-en">{{ days_percentage }}% above average</span>
                                <span class="lang-hi">{{ days_percentage }}% औसत से ऊपर</span>
                                <span class="lang-gu">{{ days_percentage }}% સરેરાશથી ઉપર</span>
                            </span>
                        {% elif days_percentage < 0 %}
                            <span class="negative"><i class="fas fa-arrow-down"></i> 
                                <span class="lang-en">{{ days_percentage|abs }}% below average</span>
                                <span class="lang-hi">{{ days_percentage|abs }}% औसत से नीचे</span>
                                <span class="lang-gu">{{ days_percentage|abs }}% સરેરાશથી નીચે</span>
                            </span>
                        {% else %}
                            <span class="text-muted">
                                <span class="lang-en">At state average</span>
                                <span class="lang-hi">राज्य औसत पर</span>
                                <span class="lang-gu">સ્ટેટ એવરેજ પર</span>
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Works Completed -->
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="comparison-card p-3 h-100">
                    <h6 class="text-muted">
                        <span class="lang-en">Works Completed</span>
                        <span class="lang-hi">पूर्ण कार्य</span>
                        <span class="lang-gu">પૂર્ણ કામ</span>
                    </h6>
                    <div class="metric-value text-primary">
                        {{ comparison_data.district.works_completed|format_number }}
                    </div>
                    <div class="text-muted small">
                        <span class="lang-en">State Avg: {{ comparison_data.state_avg.works_completed|format_number }}</span>
                        <span class="lang-hi">राज्य औसत: {{ comparison_data.state_avg.works_completed|format_number }}</span>
                        <span class="lang-gu">સ્ટેટ એવરેજ: {{ comparison_data.state_avg.works_completed|format_number }}</span>
                    </div>
                    {% set works_percentage = comparison_data.comparison_percentages.works_completed %}
                    <div class="mt-2">
                        {% if works_percentage > 0 %}
                            <span class="positive"><i class="fas fa-arrow-up"></i> 
                                <span class="lang-en">{{ works_percentage }}% above average</span>
                                <span class="lang-hi">{{ works_percentage }}% औसत से ऊपर</span>
                                <span class="lang-gu">{{ works_percentage }}% સરેરાશથી ઉપર</span>
                            </span>
                        {% elif works_percentage < 0 %}
                            <span class="negative"><i class="fas fa-arrow-down"></i> 
                                <span class="lang-en">{{ works_percentage|abs }}% below average</span>
                                <span class="lang-hi">{{ works_percentage|abs }}% औसत से नीचे</span>
                                <span class="lang-gu">{{ works_percentage|abs }}% સરેરાશથી નીચે</span>
                            </span>
                        {% else %}
                            <span class="text-muted">
                                <span class="lang-en">At state average</span>
                                <span class="lang-hi">राज्य औसत पर</span>
                                <span class="lang-gu">સ્ટેટ એવરેજ પર</span>
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Comparison Section -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-bar me-2"></i>
                            <span class="lang-en">Detailed Performance Comparison</span>
                            <span class="lang-hi">विस्तृत प्रदर्शन तुलना</span>
                            <span class="lang-gu">વિસ્તૃત પ્રદર્શન તુલના</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>
                                            <span class="lang-en">Metric</span>
                                            <span class="lang-hi">मीट्रिक</span>
                                            <span class="lang-gu">મેટ્રિક</span>
                                        </th>
                                        <th>
                                            <span class="lang-en">District Performance</span>
                                            <span class="lang-hi">जिला प्रदर्शन</span>
                                            <span class="lang-gu">જિલ્લા પ્રદર્શન</span>
                                        </th>
                                        <th>
                                            <span class="lang-en">State Average</span>
                                            <span class="lang-hi">राज्य औसत</span>
                                            <span class="lang-gu">સ્ટેટ એવરેજ</span>
                                        </th>
                                        <th>
                                            <span class="lang-en">Comparison</span>
                                            <span class="lang-hi">तुलना</span>
                                            <span class="lang-gu">તુલના</span>
                                        </th>
                                        <th>
                                            <span class="lang-en">Status</span>
                                            <span class="lang-hi">स्थिति</span>
                                            <span class="lang-gu">સ્થિતિ</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Women Participation -->
                                    <tr>
                                        <td>
                                            <span class="lang-en">Women Participation Rate</span>
                                            <span class="lang-hi">महिला भागीदारी दर</span>
                                            <span class="lang-gu">મહિલા ભાગીદારી દર</span>
                                        </td>
                                        <td>
                                            {% set women_district = (comparison_data.district.women_person_days / comparison_data.district.total_person_days * 100)|round(1) %}
                                            {{ women_district }}%
                                        </td>
                                        <td>{{ comparison_data.state_avg.women_participation_rate }}%</td>
                                        <td>
                                            {% set women_diff = women_district - comparison_data.state_avg.women_participation_rate %}
                                            {% if women_diff > 0 %}
                                                <span class="positive">+{{ women_diff }}%</span>
                                            {% elif women_diff < 0 %}
                                                <span class="negative">{{ women_diff }}%</span>
                                            {% else %}
                                                <span class="text-muted">0%</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if women_diff > 2 %}
                                                <span class="badge bg-success">
                                                    <span class="lang-en">Better</span>
                                                    <span class="lang-hi">बेहतर</span>
                                                    <span class="lang-gu">સારું</span>
                                                </span>
                                            {% elif women_diff < -2 %}
                                                <span class="badge bg-danger">
                                                    <span class="lang-en">Needs Improvement</span>
                                                    <span class="lang-hi">सुधार की आवश्यकता</span>
                                                    <span class="lang-gu">સુધારાની જરૂર</span>
                                                </span>
                                            {% else %}
                                                <span class="badge bg-warning">
                                                    <span class="lang-en">Average</span>
                                                    <span class="lang-hi">औसत</span>
                                                    <span class="lang-gu">સરેરાશ</span>
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>

                                    <!-- Works Completion Rate -->
                                    <tr>
                                        <td>
                                            <span class="lang-en">Works Completion Rate</span>
                                            <span class="lang-hi">कार्य पूर्णता दर</span>
                                            <span class="lang-gu">કામ પૂર્ણતા દર</span>
                                        </td>
                                        <td>
                                            {% set completion_district = (comparison_data.district.works_completed / comparison_data.district.works_taken_up * 100)|round(1) %}
                                            {{ completion_district }}%
                                        </td>
                                        <td>{{ comparison_data.state_avg.works_completion_rate }}%</td>
                                        <td>
                                            {% set completion_diff = completion_district - comparison_data.state_avg.works_completion_rate %}
                                            {% if completion_diff > 0 %}
                                                <span class="positive">+{{ completion_diff }}%</span>
                                            {% elif completion_diff < 0 %}
                                                <span class="negative">{{ completion_diff }}%</span>
                                            {% else %}
                                                <span class="text-muted">0%</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if completion_diff > 5 %}
                                                <span class="badge bg-success">
                                                    <span class="lang-en">Excellent</span>
                                                    <span class="lang-hi">उत्कृष्ट</span>
                                                    <span class="lang-gu">ઉત્તમ</span>
                                                </span>
                                            {% elif completion_diff > 0 %}
                                                <span class="badge bg-success">
                                                    <span class="lang-en">Good</span>
                                                    <span class="lang-hi">अच्छा</span>
                                                    <span class="lang-gu">સારું</span>
                                                </span>
                                            {% elif completion_diff < -5 %}
                                                <span class="badge bg-danger">
                                                    <span class="lang-en">Poor</span>
                                                    <span class="lang-hi">खराब</span>
                                                    <span class="lang-gu">ખરાબ</span>
                                                </span>
                                            {% else %}
                                                <span class="badge bg-warning">
                                                    <span class="lang-en">Average</span>
                                                    <span class="lang-hi">औसत</span>
                                                    <span class="lang-gu">સરેરાશ</span>
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>

                                    <!-- Expenditure per Person -->
                                    <tr>
                                        <td>
                                            <span class="lang-en">Expenditure per Person (₹)</span>
                                            <span class="lang-hi">प्रति व्यक्ति व्यय (₹)</span>
                                            <span class="lang-gu">પ્રતિ વ્યક્તિ ખર્ચ (₹)</span>
                                        </td>
                                        <td>
                                            {% set exp_per_person = (comparison_data.district.total_expenditure / comparison_data.district.persons_worked)|round(0) %}
                                            ₹{{ exp_per_person|format_number }}
                                        </td>
                                        <td>₹{{ comparison_data.state_avg.expenditure_per_person|format_number }}</td>
                                        <td>
                                            {% set exp_diff = ((exp_per_person - comparison_data.state_avg.expenditure_per_person) / comparison_data.state_avg.expenditure_per_person * 100)|round(1) %}
                                            {% if exp_diff > 0 %}
                                                <span class="positive">+{{ exp_diff }}%</span>
                                            {% elif exp_diff < 0 %}
                                                <span class="negative">{{ exp_diff }}%</span>
                                            {% else %}
                                                <span class="text-muted">0%</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if exp_diff > 10 %}
                                                <span class="badge bg-warning">
                                                    <span class="lang-en">High Cost</span>
                                                    <span class="lang-hi">उच्च लागत</span>
                                                    <span class="lang-gu">ઉચ્ચ ખર્ચ</span>
                                                </span>
                                            {% elif exp_diff < -10 %}
                                                <span class="badge bg-info">
                                                    <span class="lang-en">Cost Effective</span>
                                                    <span class="lang-hi">लागत प्रभावी</span>
                                                    <span class="lang-gu">ખર્ચ અસરકારક</span>
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary">
                                                    <span class="lang-en">Normal</span>
                                                    <span class="lang-hi">सामान्य</span>
                                                    <span class="lang-gu">સામાન્ય</span>
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>

                                    <!-- Average Days per Household -->
                                    <tr>
                                        <td>
                                            <span class="lang-en">Average Days per Household</span>
                                            <span class="lang-hi">प्रति परिवार औसत दिवस</span>
                                            <span class="lang-gu">પ્રતિ ઘર સરેરાશ દિવસો</span>
                                        </td>
                                        <td>{{ comparison_data.district.avg_days_per_household|round(1) }} 
                                            <span class="lang-en">days</span>
                                            <span class="lang-hi">दिन</span>
                                            <span class="lang-gu">દિવસો</span>
                                        </td>
                                        <td>
                                            {% if comparison_data.state_avg.avg_days_per_household %}
                                                {{ comparison_data.state_avg.avg_days_per_household }} 
                                                <span class="lang-en">days</span>
                                                <span class="lang-hi">दिन</span>
                                                <span class="lang-gu">દિવસો</span>
                                            {% else %}
                                                48.7 
                                                <span class="lang-en">days</span>
                                                <span class="lang-hi">दिन</span>
                                                <span class="lang-gu">દિવસો</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% set state_avg_days = comparison_data.state_avg.avg_days_per_household or 48.7 %}
                                            {% set days_diff = comparison_data.district.avg_days_per_household - state_avg_days %}
                                            {% if days_diff > 0 %}
                                                <span class="positive">+{{ days_diff|round(1) }} 
                                                    <span class="lang-en">days</span>
                                                    <span class="lang-hi">दिन</span>
                                                    <span class="lang-gu">દિવસો</span>
                                                </span>
                                            {% elif days_diff < 0 %}
                                                <span class="negative">{{ days_diff|round(1) }} 
                                                    <span class="lang-en">days</span>
                                                    <span class="lang-hi">दिन</span>
                                                    <span class="lang-gu">દિવસો</span>
                                                </span>
                                            {% else %}
                                                <span class="text-muted">
                                                    <span class="lang-en">Same</span>
                                                    <span class="lang-hi">समान</span>
                                                    <span class="lang-gu">સમાન</span>
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if days_diff > 5 %}
                                                <span class="badge bg-success">
                                                    <span class="lang-en">More Employment</span>
                                                    <span class="lang-hi">अधिक रोजगार</span>
                                                    <span class="lang-gu">વધુ રોજગાર</span>
                                                </span>
                                            {% elif days_diff < -5 %}
                                                <span class="badge bg-danger">
                                                    <span class="lang-en">Less Employment</span>
                                                    <span class="lang-hi">कम रोजगार</span>
                                                    <span class="lang-gu">ઓછો રોજગાર</span>
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary">
                                                    <span class="lang-en">Normal</span>
                                                    <span class="lang-hi">सामान्य</span>
                                                    <span class="lang-gu">સામાન્ય</span>
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="/dashboard?district={{ district_info.district_code }}&lang=gu" class="btn btn-primary me-2">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="lang-en">Back to Dashboard</span>
                    <span class="lang-hi">डैशबोर्ड पर वापस</span>
                    <span class="lang-gu">ડેશબોર્ડ પર પાછા</span>
                </a>
                <a href="/?lang=gu" class="btn btn-outline-secondary">
                    <i class="fas fa-home"></i>
                    <span class="lang-en">Home</span>
                    <span class="lang-hi">होम</span>
                    <span class="lang-gu">હોમ</span>
                </a>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5 py-4">
        <div class="container text-center">
            <p class="mb-0">MGNREGA Gujarat Analytics &copy; 2024</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
   <script>
document.addEventListener('DOMContentLoaded', function() {
    // Get district from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    let district = urlParams.get('district');
    
    console.log('Initial district parameter:', district);
    
    // If no district in URL or empty, try to get from referrer
    if (!district || district === '') {
        console.log('No district in URL, checking referrer...');
        
        // Check if we came from a dashboard page with district parameter
        const referrer = document.referrer;
        if (referrer && referrer.includes('/dashboard')) {
            const referrerUrl = new URL(referrer);
            const referrerDistrict = referrerUrl.searchParams.get('district');
            if (referrerDistrict) {
                district = referrerDistrict;
                console.log('Found district from referrer:', district);
                
                // Update current URL with the district parameter
                urlParams.set('district', district);
                const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
                window.history.replaceState({}, '', newUrl);
                
                // Show a message that we're updating the page
                console.log('Updated URL with district:', district);
            }
        }
    }
    
    // Final fallback - use GJ01 if still no district
    if (!district || district === '') {
        district = 'GJ01';
        console.log('Using default district:', district);
    }
    
    // Update all navigation links to include the district parameter
    updateNavigationLinks(district);
    
    function updateNavigationLinks(currentDistrict) {
        // Update dashboard link
        const dashboardLinks = document.querySelectorAll('a[href*="/dashboard"]');
        dashboardLinks.forEach(link => {
            const href = new URL(link.href, window.location.origin);
            href.searchParams.set('district', currentDistrict);
            link.href = href.toString();
        });
        
        // Update comparison links
        const comparisonLinks = document.querySelectorAll('a[href*="/comparison"]');
        comparisonLinks.forEach(link => {
            const href = new URL(link.href, window.location.origin);
            href.searchParams.set('district', currentDistrict);
            link.href = href.toString();
        });
        
        // Update home links
        const homeLinks = document.querySelectorAll('a[href="/"]');
        homeLinks.forEach(link => {
            // Home page doesn't need district parameter
            const href = new URL(link.href, window.location.origin);
            href.searchParams.delete('district');
            link.href = href.toString();
        });
        
        console.log('Updated navigation links with district:', currentDistrict);
    }
    
    // Language selector functionality
    const languageSelector = document.getElementById('languageSelector');
    if (languageSelector) {
        // Set current language
        const currentLang = document.body.getAttribute('data-lang') || 'gu';
        languageSelector.value = currentLang;
        
        languageSelector.addEventListener('change', function() {
            const selectedLang = this.value;
            document.body.setAttribute('data-lang', selectedLang);
            
            // Update URL with language parameter
            urlParams.set('lang', selectedLang);
            const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
            window.history.replaceState({}, '', newUrl);
            
            // Send language preference to server
            fetch('/set_language', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ language: selectedLang })
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      console.log('Language changed to:', selectedLang);
                  }
              });
        });
    }
});
</script>
</body>
</html> 