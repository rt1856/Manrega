{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- Hero Section -->
        <div class="card hero-card mb-5 border-0 shadow-lg">
            <div class="card-body text-center py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h1 class="display-4 mb-3">
                    <i class="fas fa-hands-helping me-3"></i>
                    <span class="lang-en">MGNREGA Gujarat Dashboard</span>
                </h1>
                <h2 class="lang-hi h3 mb-2">рдордирд░реЗрдЧрд╛ рдЧреБрдЬрд░рд╛рдд рдбреИрд╢рдмреЛрд░реНрдб</h2>
                <h2 class="lang-gu h3 mb-4">ркоркирк░рлЗркЧрк╛ ркЧрлБркЬрк░рк╛ркд ркбрлЗрк╢ркмрлЛрк░рлНркб</h2>
                <p class="lead lang-en">
                    Track your district's MGNREGA performance in simple, understandable terms
                </p>
                <p class="lead lang-hi">
                    рдЕрдкрдиреЗ рдЬрд┐рд▓реЗ рдХреЗ рдордирд░реЗрдЧрд╛ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рд╕рд░рд▓, рд╕рдордЭрдиреЗ рдпреЛрдЧреНрдп рд╢рдмреНрджреЛрдВ рдореЗрдВ рдЯреНрд░реИрдХ рдХрд░реЗрдВ
                </p>
                <p class="lead lang-gu">
                    ркдркорк╛рк░рк╛ ркЬрк┐рк▓рлНрк▓рк╛ркирк╛ ркоркирк░рлЗркЧрк╛ рккрлНрк░ркжрк░рлНрк╢ркиркирлЗ рк╕рк░рк│, рк╕ркоркЬрлА рк╢ркХрк╛ркп ркдрлЗрк╡рк╛ рк╢ркмрлНркжрлЛркорк╛ркВ ркЯрлНрк░рлЕркХ ркХрк░рлЛ
                </p>
            </div>
        </div>

        <!-- District Selection Card -->
        <div class="card shadow-lg">
            <div class="card-header bg-success text-white py-3">
                <h4 class="mb-0">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    <span class="lang-en">Select Your District</span>
                    <span class="lang-hi">рдЕрдкрдирд╛ рдЬрд┐рд▓рд╛ рдЪреБрдиреЗрдВ</span>
                    <span class="lang-gu">ркдркорк╛рк░рлЛ ркЬрк┐рк▓рлНрк▓рлЛ рккрк╕ркВркж ркХрк░рлЛ</span>
                </h4>
            </div>
            <div class="card-body p-4">
                <!-- Location Detection -->
                <div class="row mb-4">
                    <div class="col-12">
                        <button id="detectLocation" class="btn btn-outline-primary btn-lg w-100 mb-3">
                            <i class="fas fa-location-arrow me-2"></i>
                            <span class="lang-en">Auto Detect My District</span>
                            <span class="lang-hi">рдореЗрд░рд╛ рдЬрд┐рд▓рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкрд╣рдЪрд╛рдиреЗрдВ</span>
                            <span class="lang-gu">ркорк╛рк░рлЛ ркЬрк┐рк▓рлНрк▓рлЛ рк╕рлНрк╡ркЪрк╛рк▓рк┐ркд ркУрк│ркЦрлЛ</span>
                        </button>
                        <div id="locationResult" class="alert alert-info d-none text-center">
                            <!-- Location detection result will appear here -->
                        </div>
                    </div>
                </div>

                <!-- Manual Selection -->
                <form id="districtForm" action="/dashboard" method="get">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-4">
                                <label for="district" class="form-label h5">
                                    <span class="lang-en">Select District</span>
                                    <span class="lang-hi">рдЬрд┐рд▓рд╛ рдЪреБрдиреЗрдВ</span>
                                    <span class="lang-gu">ркЬрк┐рк▓рлНрк▓рлЛ рккрк╕ркВркж ркХрк░рлЛ</span>
                                </label>
                                <select class="form-select form-select-lg" id="district" name="district" required>
                                    <option value="">
                                        <span class="lang-en">-- Select District --</span>
                                        <span class="lang-hi">-- рдЬрд┐рд▓рд╛ рдЪреБрдиреЗрдВ --</span>
                                        <span class="lang-gu">-- ркЬрк┐рк▓рлНрк▓рлЛ рккрк╕ркВркж ркХрк░рлЛ --</span>
                                    </option>
                                    {% for code, name, name_hindi, name_gujarati in districts %}
                                        <option value="{{ code }}">
                                            {{ name }} - {{ name_hindi }} - {{ name_gujarati }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="mb-4">
                                <label for="year" class="form-label h5">
                                    <span class="lang-en">Year</span>
                                    <span class="lang-hi">рд╡рд░реНрд╖</span>
                                    <span class="lang-gu">рк╡рк░рлНрк╖</span>
                                </label>
                                <select class="form-select form-select-lg" id="year" name="year">
                                    {% for y in range(2020, 2026) %}
                                        <option value="{{ y }}" {% if y == 2024 %}selected{% endif %}>{{ y }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="mb-4">
                                <label for="month" class="form-label h5">
                                    <span class="lang-en">Month</span>
                                    <span class="lang-hi">рдорд╣реАрдирд╛</span>
                                    <span class="lang-gu">ркорк╣рк┐ркирлЛ</span>
                                </label>
                                <select class="form-select form-select-lg" id="month" name="month">
                                    {% for m in range(1, 13) %}
                                        <option value="{{ m }}" {% if m == current_month %}selected{% endif %}>
                                            {% if current_language == 'en' %}
                                                {{ m|get_month_name }}
                                            {% elif current_language == 'hi' %}
                                                {{ m|get_month_name_hindi }}
                                            {% else %}
                                                {{ m|get_month_name_gujarati }}
                                            {% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100 py-3">
                        <i class="fas fa-chart-bar me-2"></i>
                        <span class="lang-en">View District Performance</span>
                        <span class="lang-hi">рдЬрд┐рд▓рд╛ рдкреНрд░рджрд░реНрд╢рди рджреЗрдЦреЗрдВ</span>
                        <span class="lang-gu">ркЬрк┐рк▓рлНрк▓рлЛ рккрлНрк░ркжрк░рлНрк╢рки ркЬрлБркУ</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Information Cards -->
        <div class="row mt-5">
            <div class="col-md-4 mb-4">
                <div class="card h-100 info-card shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-users fa-3x text-primary mb-3"></i>
                        <h5 class="lang-en">12.15 Crore Beneficiaries</h5>
                        <h6 class="lang-hi">12.15 рдХрд░реЛрдбрд╝ рд▓рд╛рднрд╛рд░реНрдереА</h6>
                        <h6 class="lang-gu">12.15 ркХрк░рлЛркб рк▓рк╛ркнрк╛рк░рлНркерлАркУ</h6>
                        <p class="text-muted small lang-en">Across India in 2025</p>
                        <p class="text-muted small lang-hi">2025 рдореЗрдВ рдкреВрд░реЗ рднрд╛рд░рдд рдореЗрдВ</p>
                        <p class="text-muted small lang-gu">2025ркорк╛ркВ рк╕ркоркЧрлНрк░ ркнрк╛рк░ркдркорк╛ркВ</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100 info-card shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-rupee-sign fa-3x text-success mb-3"></i>
                        <h5 class="lang-en">100 Days Employment</h5>
                        <h6 class="lang-hi">100 рджрд┐рди рд░реЛрдЬрдЧрд╛рд░</h6>
                        <h6 class="lang-gu">100 ркжрк┐рк╡рк╕ рк░рлЛркЬркЧрк╛рк░</h6>
                        <p class="text-muted small lang-en">Guaranteed per household</p>
                        <p class="text-muted small lang-hi">рдкреНрд░рддрд┐ рдкрд░рд┐рд╡рд╛рд░ рдЧрд╛рд░рдВрдЯреАрдХреГрдд</p>
                        <p class="text-muted small lang-gu">рккрлНрк░ркдрк┐ ркШрк░ркЧркерлНркерлБ ркЧрлЗрк░ркВркЯрлАркб</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100 info-card shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-female fa-3x text-warning mb-3"></i>
                        <h5 class="lang-en">Women Empowerment</h5>
                        <h6 class="lang-hi">рдорд╣рд┐рд▓рд╛ рд╕рд╢рдХреНрддрд┐рдХрд░рдг</h6>
                        <h6 class="lang-gu">ркорк╣рк┐рк▓рк╛ рк╕рк╢ркХрлНркдрк┐ркХрк░ркг</h6>
                        <p class="text-muted small lang-en">33% participation ensured</p>
                        <p class="text-muted small lang-hi">33% рднрд╛рдЧреАрджрд╛рд░реА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд</p>
                        <p class="text-muted small lang-gu">33% ркнрк╛ркЧрлАркжрк╛рк░рлА ркЦрк╛ркдрк░рлА</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats Section -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>
                            <span class="lang-en">Quick Statistics</span>
                            <span class="lang-hi">рддреНрд╡рд░рд┐рдд рдЖрдВрдХрдбрд╝реЗ</span>
                            <span class="lang-gu">ркЭркбрккрлА ркЖркВркХркбрк╛</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3 mb-3">
                                <h4 class="text-primary">33</h4>
                                <p class="lang-en">Districts Covered</p>
                                <p class="lang-hi">рдХрд╡рд░ рдХрд┐рдП рдЧрдП рдЬрд┐рд▓реЗ</p>
                                <p class="lang-gu">ркХрк╡рк░ ркХрк░рлЗрк▓рк╛ ркЬрк┐рк▓рлНрк▓рк╛ркУ</p>
                            </div>
                            <div class="col-md-3 mb-3">
                                <h4 class="text-success">98%</h4>
                                <p class="lang-en">Data Accuracy</p>
                                <p class="lang-hi">рдбреЗрдЯрд╛ рд╕рдЯреАрдХрддрд╛</p>
                                <p class="lang-gu">ркбрлЗркЯрк╛ ркЪрлЛркХрк╕рк╛ркИ</p>
                            </div>
                            <div class="col-md-3 mb-3">
                                <h4 class="text-warning">24/7</h4>
                                <p class="lang-en">Live Updates</p>
                                <p class="lang-hi">рд▓рд╛рдЗрд╡ рдЕрдкрдбреЗрдЯ</p>
                                <p class="lang-gu">рк▓рк╛ркИрк╡ ркЕрккркбрлЗркЯрлНрк╕</p>
                            </div>
                            <div class="col-md-3 mb-3">
                                <h4 class="text-danger">100%</h4>
                                <p class="lang-en">Free Service</p>
                                <p class="lang-hi">рдореБрдлреНрдд рд╕реЗрд╡рд╛</p>
                                <p class="lang-gu">ркорклркд рк╕рлЗрк╡рк╛</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hero-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
}

.info-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: none;
    border-radius: 10px;
}

.info-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.card {
    border-radius: 10px;
}

.btn-lg {
    border-radius: 10px;
}

.form-select-lg {
    border-radius: 8px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize location detection
    const detectBtn = document.getElementById('detectLocation');
    const locationResult = document.getElementById('locationResult');
    const districtSelect = document.getElementById('district');
    
    if (detectBtn) {
        detectBtn.addEventListener('click', function() {
            detectBtn.disabled = true;
            detectBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i><span class="lang-en">Detecting...</span><span class="lang-hi">рдкрд╣рдЪрд╛рди рд░рд╣рд╛...</span><span class="lang-gu">рк╢рлЛркзрлА рк░рк╣рлНркпрлБркВ ркЫрлЗ...</span>';
            
            // Clear previous results
            locationResult.innerHTML = '';
            locationResult.className = 'alert alert-info text-center';
            locationResult.classList.remove('d-none');
            
            if (navigator.geolocation) {
                console.log('Geolocation supported, requesting location...');
                
                const geoOptions = {
                    enableHighAccuracy: true,
                    timeout: 10000,  // 10 seconds
                    maximumAge: 60000 // 1 minute
                };
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        console.log('Location obtained:', position);
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        locationResult.innerHTML = `
                            <div class="lang-en">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                Location found: ${lat.toFixed(4)}, ${lon.toFixed(4)}
                            </div>
                            <div class="lang-hi">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                рд╕реНрдерд╛рди рдорд┐рд▓рд╛: ${lat.toFixed(4)}, ${lon.toFixed(4)}
                            </div>
                            <div class="lang-gu">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                рк╕рлНркерк╛рки ркорк│рлНркпрлБркВ: ${lat.toFixed(4)}, ${lon.toFixed(4)}
                            </div>
                        `;
                        
                        // Send to server
                        fetch('/api/geolocation', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                latitude: lat,
                                longitude: lon
                            })
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('Server response:', data);
                            
                            if (data.success) {
                                // Set the district in the dropdown
                                districtSelect.value = data.district_code;
                                
                                // Show success message
                                locationResult.innerHTML = `
                                    <div class="lang-en">
                                        <i class="fas fa-check-circle me-2 text-success"></i>
                                        тЬЕ Detected: ${data.district_name}
                                    </div>
                                    <div class="lang-hi">
                                        <i class="fas fa-check-circle me-2 text-success"></i>
                                        тЬЕ рдкрд╣рдЪрд╛рдирд╛ рдЧрдпрд╛: ${data.district_name_hindi}
                                    </div>
                                    <div class="lang-gu">
                                        <i class="fas fa-check-circle me-2 text-success"></i>
                                        тЬЕ рк╢рлЛркзрк╛ркпрлБркВ: ${data.district_name_gujarati}
                                    </div>
                                    <div class="mt-2 small lang-en">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Click "View District Performance" to continue
                                    </div>
                                    <div class="mt-2 small lang-hi">
                                        <i class="fas fa-info-circle me-1"></i>
                                        рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП "рдЬрд┐рд▓рд╛ рдкреНрд░рджрд░реНрд╢рди рджреЗрдЦреЗрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
                                    </div>
                                    <div class="mt-2 small lang-gu">
                                        <i class="fas fa-info-circle me-1"></i>
                                        ркЪрк╛рк▓рлБ рк░рк╛ркЦрк╡рк╛ ркорк╛ркЯрлЗ "ркЬрк┐рк▓рлНрк▓рлЛ рккрлНрк░ркжрк░рлНрк╢рки ркЬрлБркУ" рккрк░ ркХрлНрк▓рк┐ркХ ркХрк░рлЛ
                                    </div>
                                `;
                                locationResult.className = 'alert alert-success text-center';
                                
                                // Auto-submit after 2 seconds
                                setTimeout(() => {
                                    document.getElementById('districtForm').submit();
                                }, 2000);
                                
                            } else {
                                throw new Error(data.error || 'Unknown error from server');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            locationResult.innerHTML = `
                                <div class="lang-en">
                                    <i class="fas fa-times-circle me-2 text-danger"></i>
                                    тЭМ Error: ${error.message}
                                </div>
                                <div class="lang-hi">
                                    <i class="fas fa-times-circle me-2 text-danger"></i>
                                    тЭМ рддреНрд░реБрдЯрд┐: ${error.message}
                                </div>
                                <div class="lang-gu">
                                    <i class="fas fa-times-circle me-2 text-danger"></i>
                                    тЭМ ркнрлВрк▓: ${error.message}
                                </div>
                                <div class="mt-2 small lang-en">
                                    Please select your district manually from the dropdown.
                                </div>
                                <div class="mt-2 small lang-hi">
                                    рдХреГрдкрдпрд╛ рдбреНрд░реЙрдкрдбрд╛рдЙрди рд╕реЗ рдЕрдкрдирд╛ рдЬрд┐рд▓рд╛ рдореИрдиреНрдпреБрдЕрд▓реА рдЪреБрдиреЗрдВред
                                </div>
                                <div class="mt-2 small lang-gu">
                                    ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркбрлНрк░рлЛрккркбрк╛ркЙркиркорк╛ркВркерлА ркдркорк╛рк░рлЛ ркЬрк┐рк▓рлНрк▓рлЛ ркорлЗркирлНркпрлБркЕрк▓рлА рккрк╕ркВркж ркХрк░рлЛ.
                                </div>
                            `;
                            locationResult.className = 'alert alert-danger text-center';
                        })
                        .finally(() => {
                            detectBtn.disabled = false;
                            detectBtn.innerHTML = '<i class="fas fa-location-arrow me-2"></i><span class="lang-en">Auto Detect My District</span><span class="lang-hi">рдореЗрд░рд╛ рдЬрд┐рд▓рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкрд╣рдЪрд╛рдиреЗрдВ</span><span class="lang-gu">ркорк╛рк░рлЛ ркЬрк┐рк▓рлНрк▓рлЛ рк╕рлНрк╡ркЪрк╛рк▓рк┐ркд ркУрк│ркЦрлЛ</span>';
                        });
                    },
                    function(error) {
                        console.error('Geolocation error:', error);
                        detectBtn.disabled = false;
                        detectBtn.innerHTML = '<i class="fas fa-location-arrow me-2"></i><span class="lang-en">Auto Detect My District</span><span class="lang-hi">рдореЗрд░рд╛ рдЬрд┐рд▓рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкрд╣рдЪрд╛рдиреЗрдВ</span><span class="lang-gu">ркорк╛рк░рлЛ ркЬрк┐рк▓рлНрк▓рлЛ рк╕рлНрк╡ркЪрк╛рк▓рк┐ркд ркУрк│ркЦрлЛ</span>';
                        
                        let errorMessage = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = `
                                    <div class="lang-en">
                                        <i class="fas fa-shield-alt me-2 text-warning"></i>
                                        ЁЯФТ Location access denied by browser
                                    </div>
                                    <div class="lang-hi">
                                        <i class="fas fa-shield-alt me-2 text-warning"></i>
                                        ЁЯФТ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рд╕реНрдерд╛рди рдПрдХреНрд╕реЗрд╕ рдЕрд╕реНрд╡реАрдХреГрдд
                                    </div>
                                    <div class="lang-gu">
                                        <i class="fas fa-shield-alt me-2 text-warning"></i>
                                        ЁЯФТ ркмрлНрк░рк╛ркЙркЭрк░ ркжрлНрк╡рк╛рк░рк╛ рк╕рлНркерк╛рки ркНркХрлНрк╕рлЗрк╕ ркиркХрк╛рк░рк╡рк╛ркорк╛ркВ ркЖрк╡рлА
                                    </div>
                                    <div class="mt-2 small lang-en">
                                        Please allow location access in your browser settings or select manually.
                                    </div>
                                    <div class="mt-2 small lang-hi">
                                        рдХреГрдкрдпрд╛ рдЕрдкрдиреА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рд╕реНрдерд╛рди рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ рдпрд╛ рдореИрдиреНрдпреБрдЕрд▓реА рдЪреБрдиреЗрдВред
                                    </div>
                                    <div class="mt-2 small lang-gu">
                                        ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркдркорк╛рк░рлА ркмрлНрк░рк╛ркЙркЭрк░ рк╕рлЗркЯрк┐ркВркЧрлНрк╕ркорк╛ркВ рк╕рлНркерк╛рки ркНркХрлНрк╕рлЗрк╕ркирлА рккрк░рк╡рк╛ркиркЧрлА ркЖрккрлЛ ркЕркерк╡рк╛ ркорлЗркирлНркпрлБркЕрк▓рлА рккрк╕ркВркж ркХрк░рлЛ.
                                    </div>
                                `;
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = `
                                    <div class="lang-en">
                                        <i class="fas fa-wifi me-2 text-warning"></i>
                                        ЁЯУб Location information unavailable
                                    </div>
                                    <div class="lang-hi">
                                        <i class="fas fa-wifi me-2 text-warning"></i>
                                        ЁЯУб рд╕реНрдерд╛рди рдЬрд╛рдирдХрд╛рд░реА рдЕрдиреБрдкрд▓рдмреНрдз
                                    </div>
                                    <div class="lang-gu">
                                        <i class="fas fa-wifi me-2 text-warning"></i>
                                        ЁЯУб рк╕рлНркерк╛рки ркорк╛рк╣рк┐ркдрлА ркЙрккрк▓ркмрлНркз ркиркерлА
                                    </div>
                                `;
                                break;
                            case error.TIMEOUT:
                                errorMessage = `
                                    <div class="lang-en">
                                        <i class="fas fa-clock me-2 text-warning"></i>
                                        тП░ Location request timed out
                                    </div>
                                    <div class="lang-hi">
                                        <i class="fas fa-clock me-2 text-warning"></i>
                                        тП░ рд╕реНрдерд╛рди рдЕрдиреБрд░реЛрдз рд╕рдордп рд╕рдорд╛рдкреНрдд
                                    </div>
                                    <div class="lang-gu">
                                        <i class="fas fa-clock me-2 text-warning"></i>
                                        тП░ рк╕рлНркерк╛рки рк╡рк┐ркиркВркдрлА рк╕ркоркп рк╕ркорк╛рккрлНркд
                                    </div>
                                `;
                                break;
                            default:
                                errorMessage = `
                                    <div class="lang-en">
                                        <i class="fas fa-question-circle me-2 text-warning"></i>
                                        тЭУ Unknown error occurred
                                    </div>
                                    <div class="lang-hi">
                                        <i class="fas fa-question-circle me-2 text-warning"></i>
                                        тЭУ рдЕрдЬреНрдЮрд╛рдд рддреНрд░реБрдЯрд┐ рд╣реБрдИ
                                    </div>
                                    <div class="lang-gu">
                                        <i class="fas fa-question-circle me-2 text-warning"></i>
                                        тЭУ ркЕркЬрлНркЮрк╛ркд ркнрлВрк▓ ркЖрк╡рлА
                                    </div>
                                `;
                        }
                        
                        locationResult.innerHTML = errorMessage;
                        locationResult.className = 'alert alert-warning text-center';
                        locationResult.classList.remove('d-none');
                    },
                    geoOptions
                );
            } else {
                detectBtn.disabled = false;
                detectBtn.innerHTML = '<i class="fas fa-location-arrow me-2"></i><span class="lang-en">Auto Detect My District</span><span class="lang-hi">рдореЗрд░рд╛ рдЬрд┐рд▓рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкрд╣рдЪрд╛рдиреЗрдВ</span><span class="lang-gu">ркорк╛рк░рлЛ ркЬрк┐рк▓рлНрк▓рлЛ рк╕рлНрк╡ркЪрк╛рк▓рк┐ркд ркУрк│ркЦрлЛ</span>';
                
                locationResult.innerHTML = `
                    <div class="lang-en">
                        <i class="fas fa-times-circle me-2 text-danger"></i>
                        тЭМ Geolocation not supported by your browser
                    </div>
                    <div class="lang-hi">
                        <i class="fas fa-times-circle me-2 text-danger"></i>
                        тЭМ рдЖрдкрдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рдЬрд┐рдпреЛрд▓реЛрдХреЗрд╢рди рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИ
                    </div>
                    <div class="lang-gu">
                        <i class="fas fa-times-circle me-2 text-danger"></i>
                        тЭМ ркдркорк╛рк░рк╛ ркмрлНрк░рк╛ркЙркЭрк░ ркжрлНрк╡рк╛рк░рк╛ ркЬрлАркУрк▓рлЛркХрлЗрк╢рки рк╕рккрлЛрк░рлНркЯрлЗркб ркиркерлА
                    </div>
                    <div class="mt-2 small lang-en">
                        Please update your browser or select district manually.
                    </div>
                    <div class="mt-2 small lang-hi">
                        рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ рдпрд╛ рдЬрд┐рд▓рд╛ рдореИрдиреНрдпреБрдЕрд▓реА рдЪреБрдиреЗрдВред
                    </div>
                    <div class="mt-2 small lang-gu">
                        ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркдркорк╛рк░рлБркВ ркмрлНрк░рк╛ркЙркЭрк░ ркЕрккркбрлЗркЯ ркХрк░рлЛ ркЕркерк╡рк╛ ркЬрк┐рк▓рлНрк▓рлЛ ркорлЗркирлНркпрлБркЕрк▓рлА рккрк╕ркВркж ркХрк░рлЛ.
                    </div>
                `;
                locationResult.className = 'alert alert-danger text-center';
                locationResult.classList.remove('d-none');
            }
        });
    }
    
    // Test function to simulate location detection (for development)
    function simulateLocationDetection() {
        console.log('Simulating location detection...');
        // This simulates Ahmedabad coordinates
        const mockLat = 23.0225;
        const mockLon = 72.5714;
        
        fetch('/api/geolocation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                latitude: mockLat,
                longitude: mockLon
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log('Mock location result:', data);
            if (data.success) {
                districtSelect.value = data.district_code;
                alert(`Mock detection: ${data.district_name}`);
            }
        });
    }
    
    // Uncomment the line below to enable mock location for testing
    // simulateLocationDetection();
});
</script>
{% endblock %}